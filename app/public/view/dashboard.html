<!DOCTYPE HTML>
<html>
   <head>
      <meta charset="utf-8">
      <title>Arquitectura Avanzada - Dashboard</title>
      <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
      <link href="../css/bootstrap.min.css" rel="stylesheet">
      <link href="../css/dashboard.css" rel="stylesheet">
      <script src="https://www.gstatic.com/charts/loader.js"></script>
      <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
      <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>

      <!-- <script src="../js/scripts.js"></script> -->
      <script>
         // canvas request for all browsers
         window.requestAnimFrame = (function(callback) {
               return window.requestAnimationFrame || 
               window.webkitRequestAnimationFrame || 
               window.mozRequestAnimationFrame || 
               window.oRequestAnimationFrame || 
               window.msRequestAnimationFrame ||
               function(callback) {
                 window.setTimeout(callback, 1000 / 30); // 30 frames per second
           };
         })();
           
         var iosocket;
         var text;
         
         window.onload = function() {
               google.charts.load('current', {'packages':['gauge']});
               google.charts.setOnLoadCallback(drawChart);
           };
             
           function colorAlert(tdId,redFrom,yellowFrom) {
              if (recievedData > redFrom){
                     document.getElementById(tdId).style.backgroundColor = "#DC3912";
                   }
                   else  if (recievedData < redFrom && recievedData > yellowFrom){
                     document.getElementById(tdId).style.backgroundColor = "#FF9900";
                   }
                   else {
                     document.getElementById(tdId).style.backgroundColor = "#38c766";
                  }
           }  
         
           function drawChart() {
         
               //umbrales temperatura,humedad,viento
               //TODO tomar parametros
               var temp_yellowFrom =40;
               var temp_yellowTo =90;
               var hum_yellowFrom =40;
               var hum_yellowTo = 90;
               var viento_yellowFrom =20;
               var viento_yellowTo = 60;
               var temp_redFrom =45;
               var temp_redTo =100;
               var hum_redFrom =90;
               var hum_redTo = 100;
               var viento_redFrom =60;
               var viento_redTo = 100;
         
               var dataTemp = google.visualization.arrayToDataTable([
                 ['Label', 'Value'],
                 ['Temperatura', 0],
               ]);
               
               var dataViento = google.visualization.arrayToDataTable([
                 ['Label', 'Value'],
                 ['Viento', 0],
               ]);
               
               var dataHum = google.visualization.arrayToDataTable([
                 ['Label', 'Value'],
                 ['Humedad', 0]
               ]);
         
               var optionsHum = {
                 width: 200, height: 200,
                 yellowFrom: hum_yellowFrom, yellowTo:hum_yellowTo,
                 redFrom: hum_redFrom, redTo: hum_redTo,
                 minorTicks: 5
               };
            
               var optionsTemp = {
                 width: 200, height: 200,
                 yellowFrom: temp_yellowFrom, yellowTo:temp_yellowTo,
                 redFrom: temp_redFrom, redTo: temp_redTo,
                 minorTicks: 5
               };
               
               var optionsViento = {
                 width: 200, height: 200,
                 yellowFrom: viento_yellowFrom, yellowTo:viento_yellowTo,
                 redFrom: viento_redFrom, redTo: viento_redTo,
                 minorTicks: 5,
               };
         
               var chartTemp = new google.visualization.Gauge(document.getElementById('chartTemp_div'));
               var chartViento = new google.visualization.Gauge(document.getElementById('chartViento_div'));
               var chartHum = new google.visualization.Gauge(document.getElementById('chartHum_div'));
         
               
               chartTemp.draw(dataTemp, optionsTemp);
               chartViento.draw(dataHum, optionsHum);
               chartHum.draw(dataViento, optionsViento);
         
               iosocket = io.connect();
               iosocket.on('onconnection', function(value) {
               
               // recieve changed values by other client from server
               iosocket.on('updateViento', recievedData => {
                   console.log('Viento', recievedData);
                   colorAlert("td3",viento_redFrom,viento_yellowFrom);
                   setInterval(function() {
                   dataViento.setValue(0, 1, recievedData);
                   chartViento.draw(dataViento, optionsViento);
                 }, 1000);
               });
         
               iosocket.on('updateHumedad', recievedData => {
                    console.log('Humedad', recievedData);
                    colorAlert("td2",hum_redFrom,hum_yellowFrom);
                    setInterval(function() {
                   dataHum.setValue(0, 1, recievedData);
                   chartHum.draw(dataHum, optionsHum);
                 }, 1000);
               });
         
               iosocket.on('updateTemperatura', recievedData => {
                   console.log('Temperatura', recievedData);
                   colorAlert("td1",temp_redFrom,temp_yellowFrom);
                   setInterval(function() {
                   dataTemp.setValue(0, 1, recievedData);
                   chartTemp.draw(dataTemp, optionsTemp);
                 }, 1000);
               });
             });
         
              }
         
         
         
            
   </script>
   </head>
   <body>
    <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
      <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#">Estación Meteorológica</a>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
        </ul>
      </div>
      <button class="btn btn-outline-success my-2 my-sm-0"  onclick="window.location='login.html'">Salir</button>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-sm-3 col-md-2 hidden-xs-down bg-faded sidebar">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="#">Sensores Analógicos <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Sensores Digitales</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Setup</a>
            </li>
           </ul>

        </nav>

        <main class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 pt-3">
          <h1>Dashboard</h1>

          <section class="row text-center placeholders">
            <table align="center" border="0" height="200px" style="text-align: center;">
            <tr >
               <td  id="td1" >
                  <div id="chartTemp_div" style="width: 200px; height: 120px;"></div>
               </td>
               <td  id="td2" >
                  <div id="chartHum_div" style="width: 200px; height: 120px;"></div>
               </td>
               <td  id="td3" >
                  <div id="chartViento_div" style="width: 200px; height: 120px;"></div>
               </td>
            </tr>
         </table>
          </section>

          
          </div>
        </main>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
  </body>
 </html>